---
- hosts: ansible
  become: yes
  vars:
    docker_image_name: "myapp"
    docker_image_tag: "v1.0"
    docker_registry: "docker.io"
    docker_username: "advit2012"
    docker_password: "{{ docker_password | default('Manjeet123') }}"  # Use a default but recommend securing this

  tasks:

    - name: Install Docker if not already installed
      apt:
        name: docker.io
        state: present
        update_cache: yes

    - name: Start Docker service
      service:
        name: docker
        state: started
        enabled: yes

    - name: Build the Docker image
      command: docker build -t {{ docker_image_name }}:{{ docker_image_tag }} -f {{ docker_file_path }} .
      args:
        chdir: "{{ ansible_env.HOME }}"  # Optional: Set the working directory if needed

    - name: Log in to Docker registry
      docker_login:
        registry_url: "{{ docker_registry }}"
        username: "{{ docker_username }}"
        password: "{{ docker_password }}"

    - name: Tag the Docker image for the registry
      command: docker tag {{ docker_image_name }}:{{ docker_image_tag }} {{ docker_registry }}/{{ docker_image_name }}:{{ docker_image_tag }}

    - name: Push the Docker image to the registry
      command: docker push {{ docker_registry }}/{{ docker_image_name }}:{{ docker_image_tag }}

    - name: Log out from Docker registry
      command: docker logout {{ docker_registry }}

   
 

